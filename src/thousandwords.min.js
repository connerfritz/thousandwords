define("vendor/thousandwords",["exports"],function(t){function i(t,i){this.canvas=null,this.options=null,this.element=null,this.canvasWidth=800,this.canvasHeight=800,this.minWidth=null,this.minHeight=null,this.down=!1,this.imageY=0,this.original={width:0,height:0,scale:0},this.mouse={x:0,y:0,state:!1,grab:!1},this.cropper={x:0,y:0,width:0,height:0,x2:function(){return this.x+this.width},y2:function(){return this.y+this.height}},this.errors=[],this.init(t,i)}i.prototype.init=function(t,i){"string"==typeof t&&(this.element=document.querySelector(t)),this.options=i,this.create(),this.loadImage()},i.prototype.reset=function(t){this.canvas.parentElement.removeChild(this.canvas),this.options=t,this.init(this.element,t)},i.prototype.handleEvent=function(t){"mousemove"===t.type&&this.mouseMove(t),"mousedown"===t.type&&this.mouseDown(t),"mouseup"===t.type&&this.mouseUp(t),"touchstart"===t.type&&this.mouseDown(t.touches[0]),"touchend"===t.type&&this.mouseUp(t),"touchmove"===t.type&&(t.preventDefault(),this.mouseMove(t.touches[0]))},i.prototype.create=function(){this.canvas=document.createElement("canvas"),this.canvas.className="thousandwords-cropper",this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.element.appendChild(this.canvas),document.addEventListener("mousedown",this,!1),document.addEventListener("mouseup",this,!1),document.addEventListener("mousemove",this,!1),document.addEventListener("touchstart",this,!1),document.addEventListener("touchend",this,!1),this.canvas.addEventListener("touchmove",this,!1)},i.prototype.loadImage=function(){var t=this;return this.image=new Image,this.image.src=this.options.src,this.image.onload=function(){t.resizeImage(),t.render()},this.image},i.prototype.resizeImage=function(){var t=this.image.width,i=this.image.height;this.original.width=t,this.original.height=i,t>i?t>this.canvasWidth&&(this.original.scale=this.canvasWidth/this.image.width):i>=this.canvasHeight&&(this.original.scale=this.canvasHeight/this.image.height),this.minWidth=Math.round(this.options.width*this.original.scale),this.minHeight=Math.round(this.options.height*this.original.scale),upperWidth=i/this.minHeight*this.minWidth,upperHeight=t/this.minWidth*this.minHeight,this.defaultCropperSetting(t,i,upperWidth,upperHeight),isNaN(this.options.crop_width)||isNaN(this.options.crop_height)||isNaN(this.options.crop_x)||isNaN(this.options.crop_y)||!(this.options.crop_width*this.options.crop_height>0)||(this.cropper.width=this.options.crop_width,this.cropper.height=this.options.crop_height,this.cropper.x=this.options.crop_x,this.cropper.y=this.options.crop_y,(this.options.crop_width+this.options.crop_x>t||this.options.crop_height+this.options.crop_y>i)&&this.defaultCropperSetting(t,i,upperWidth,upperHeight))},i.prototype.defaultCropperSetting=function(t,i,e,s){i>=s?(this.cropper.x=0,this.cropper.y=0,this.cropper.width=t,this.cropper.height=s):(this.cropper.x=0,this.cropper.y=0,this.cropper.width=e,this.cropper.height=i)},i.prototype.render=function(){this.renderPicture(),this.renderBlackspace(),this.renderTriangle()},i.prototype.renderPicture=function(){this.canvas.width=this.image.width,this.canvas.height=this.image.height,this.canvas.getContext("2d").drawImage(this.image,0,this.imageY,this.image.width,this.image.height)},i.prototype.renderBlackspace=function(){this.canvas.getContext("2d").fillStyle="rgba( 0,0,0,0.7)",this.canvas.getContext("2d").fillRect(0,this.imageY,this.cropper.x,this.image.height),this.canvas.getContext("2d").fillRect(this.cropper.x2(),this.imageY,this.canvas.width-this.cropper.width,this.image.height),this.canvas.getContext("2d").fillRect(this.cropper.x,this.imageY,this.cropper.width,this.cropper.y-this.imageY),this.canvas.getContext("2d").fillRect(this.cropper.x,this.cropper.y2(),this.cropper.width,this.imageY+this.image.height-this.cropper.y-this.cropper.height),this.canvas.getContext("2d").strokeStyle="rgba(255,255,255,1)",this.canvas.getContext("2d").lineWidth=3,this.canvas.getContext("2d").setLineDash([20]),this.canvas.getContext("2d").strokeRect(this.cropper.x,this.cropper.y,this.cropper.width,this.cropper.height)},i.prototype.renderTriangle=function(){corner=50,this.canvas.getContext("2d").fillStyle="rgba(255,255,255,1)",this.canvas.getContext("2d").strokeStyle="rgba(0,0,0,0.8)",this.canvas.getContext("2d").lineWidth=5,this.canvas.getContext("2d").setLineDash([null]),this.canvas.getContext("2d").beginPath(),this.canvas.getContext("2d").moveTo(this.cropper.x2()-corner,this.cropper.y2()),this.canvas.getContext("2d").lineTo(this.cropper.x2(),this.cropper.y2()),this.canvas.getContext("2d").lineTo(this.cropper.x2(),this.cropper.y2()-corner),this.canvas.getContext("2d").lineTo(this.cropper.x2()-corner,this.cropper.y2()),this.canvas.getContext("2d").fill(),this.canvas.getContext("2d").stroke(),this.canvas.getContext("2d").closePath()},i.prototype.buildMouse=function(t){offset=this.canvas.getBoundingClientRect(),x=Math.round((t.clientX-offset.left)*(this.canvas.width/offset.width)),y=Math.round((t.clientY-offset.top)*(this.canvas.height/offset.height)),grab=this.mouse.grab,state=this.mouse.state,0===this.mouse.state&&(state=this.getMouseState(x,y)),this.mouse.grab===!1&&(grab=this.getMouseGrab(x,y)),this.mouse={x:x,y:y,grab:grab,state:state}},i.prototype.mouseDown=function(t){this.buildMouse(t),this.down=!0,this.mouse.grab=!1,this.mouse.state=0},i.prototype.mouseUp=function(){this.mouse.state=!1,this.mouse.grab=!1,this.down=!1},i.prototype.mouseMove=function(t){this.mouse.state!==!1&&(this.buildMouse(t),1==this.mouse.state&&this.drag(),2==this.mouse.state&&this.scale()),this.render()},i.prototype.getMouseState=function(t,i){return x1=this.cropper.x,x2=this.cropper.x2(),y1=this.cropper.y,y2=this.cropper.y2(),corner=50,state=this.mouse.state,0==state&&x1<t&&t<x2&&y1<i&&i<y2?x2-corner<t&&y2-corner<i?2:1:state>0?state:0},i.prototype.getMouseGrab=function(t,i){return x1=this.cropper.x,y1=this.cropper.y,{x:t-x1,y:i-y1}},i.prototype.drag=function(){x1=this.mouse.x-this.mouse.grab.x,y1=this.mouse.y-this.mouse.grab.y,width=this.cropper.width,height=this.cropper.height,this.validator(x1,y1,width,height)},i.prototype.scale=function(){x1=this.cropper.x,y1=this.cropper.y,width=this.mouse.x-this.cropper.x+(this.cropper.width-this.mouse.grab.x),height=width/(this.options.width/this.options.height),delta=this.cropper.width,this.rect=this.validator(x1,y1,width,height),this.mouse.grab.x=this.mouse.grab.x+this.cropper.width-delta},i.prototype.validator=function(t,i,e,s){2==this.mouse.state&&(this.image.width<=e+t&&(e=this.image.width-t,s=e/(this.options.width/this.options.height)),this.image.height+this.imageY<=s+i&&(s=this.image.height+this.imageY-i,e=s*(this.options.width/this.options.height)),e<=this.minWidth&&(e=this.minWidth,s=this.minHeight)),1==this.mouse.state&&(this.image.width<=e+t&&(t=this.image.width-this.cropper.width),this.image.height+this.imageY<=s+i&&(i=this.image.height-this.cropper.height+this.imageY),0>t&&(t=0),i<this.imageY&&(i=this.imageY)),this.setCropper(t,i,e,s)},i.prototype.setCropper=function(t,i,e,s){this.cropper.x=t,this.cropper.y=i,this.cropper.width=e,this.cropper.height=s},i.prototype.getImage=function(){return{xOffset:Math.round(this.cropper.x),yOffset:Math.round(this.cropper.y),width:Math.round(this.cropper.width),height:Math.round(this.cropper.height)}},t["default"]=i});
